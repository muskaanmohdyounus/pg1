{% load static %}

<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Create Rent</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'expenses/css/sidebar.css' %}">
    <link rel="stylesheet" href="{% static 'expenses/css/owner_rent.css' %}">
</head>
<body>

{% include 'expenses/sidebar.html' %}

<div class="main-content p-4">
    <div class="container">
        <h3 class="mb-4 fw-bold">Create Rent</h3>

        <!-- ✅ SUCCESS / ERROR MESSAGES -->
        {% if messages %}
          {% for message in messages %}
            <div class="alert alert-{{ message.tags }}">
                {{ message }}
            </div>
          {% endfor %}
        {% endif %}

        {% if form.errors %}
          <div class="alert alert-danger">
            {{ form.errors }}
          </div>
        {% endif %}

        <div class="card shadow-sm">
            <div class="card-body">
                <form method="POST">
                    {% csrf_token %}

                    <!-- Tenant dropdown -->
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Tenant</label>
                            {{ form.tenant }}
                        </div>

                        <!-- Auto-fill Property -->
                        <div class="col-md-6">
                            <label class="form-label">Property</label>
                            <input type="text" id="property_name" class="form-control" readonly>
                        </div>
                    </div>

                    <!-- Auto-fill Room + Month + Year + Room Sharing -->
                    <div class="row mb-3">
                        <div class="col-md-3">
                            <label class="form-label">Room Number</label>
                            <input type="text" id="room_no" class="form-control" readonly>
                        </div>

                        <div class="col-md-3">
                            <label class="form-label">Rent Month</label>
                            {{ form.billing_month }}
                        </div>

                        <div class="col-md-3">
                            <label class="form-label">Year</label>
                            {{ form.billing_year }}
                        </div>

                        <div class="col-md-3">
                            <label class="form-label">Room Sharing</label>
                            {{ form.room_sharing }}
                        </div>
                    </div>

                    <!-- Amount -->
                    <div class="row mb-4">
                        <div class="col-md-4">
                            <label class="form-label">Rent Amount</label>
                            {{ form.rent_amount }}
                        </div>
                    </div>
                    <!-- Due Date -->
<div class="row mb-4">
    <div class="col-md-4">
        <label class="form-label">Due Date</label>
        {{ form.due_date }}
    </div>
</div>


                    <!-- Buttons -->
                    <button class="btn btn-primary px-4" type="submit">Create Rent</button>
                    <a href="{% url 'owner_rental_dashboard' %}" class="btn btn-secondary">Cancel</a>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- ✅ AUTO-FILL PROPERTY & ROOM -->
<script>
    const tenantData = {
        {% for t in form.fields.tenant.queryset %}
        "{{ t.id }}": {
            "property": "{{ t.tenant_property.name }}",
            "room": "{{ t.room_number }}"
        },
        {% endfor %}
    };

    const tenantSelect = document.getElementById("id_tenant");
    tenantSelect.addEventListener("change", function() {
        const t = this.value;
        if (tenantData[t]) {
            document.getElementById("property_name").value = tenantData[t].property;
            document.getElementById("room_no").value = tenantData[t].room;
        } else {
            document.getElementById("property_name").value = "";
            document.getElementById("room_no").value = "";
        }
    });
</script>

</body>
</html>
