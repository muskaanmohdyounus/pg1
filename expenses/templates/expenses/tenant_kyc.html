{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tenant KYC</title>

    <!-- Bootstrap & FontAwesome -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="{% static 'expenses/css/tenatsidebar.css' %}">
    <link rel="stylesheet" href="{% static 'expenses/css/tenant_kyc.css' %}">
</head>
<body>

{% include 'expenses/tenant/tenant_sidebar.html' %}

<div class="kyc-wrapper">

    <!-- Header -->
    <div class="kyc-header">
        <h2><i class="fa-solid fa-id-card-clip"></i> Tenant KYC Verification</h2>
        <p>Please fill out your KYC details to verify your identity and complete your profile.</p>
    </div>

    <!-- Tenant Info Card -->
    <div class="kyc-card">
        <div class="section-title">
            <i class="fa-solid fa-user"></i> Your Basic Details
        </div>

        <div class="tenant-info">
            <p><strong>Full Name:</strong> {{ tenant_info.full_name }}</p>
            <p><strong>Phone:</strong> {{ tenant_info.phone }}</p>
            <p><strong>Email:</strong> {{ tenant_info.email }}</p>

            {% if kyc.kyc_status == 'submitted' %}
                <span class="badge bg-primary">KYC Submitted - Awaiting Approval</span>
            {% elif kyc.kyc_status == 'verified' %}
                <span class="badge bg-success">KYC Approved & Verified</span>
            {% elif kyc.kyc_status == 'rejected' %}
                <span class="badge bg-danger">KYC Rejected - Please Update</span>
            {% else %}
                <span class="badge bg-secondary">New Submission</span>
            {% endif %}

        </div>
    </div>

    <!-- KYC Form Card -->
    <div class="kyc-card" id="kycFormCard">
        <div class="section-title">
            <i class="fa-solid fa-clipboard-list"></i> KYC Information
        </div>

        {% if kyc.kyc_status == 'submitted' or kyc.kyc_status == 'verified' %}
            <fieldset disabled>
        {% endif %}

        <form method="POST" enctype="multipart/form-data" id="kycForm">
            {% csrf_token %}

            <div class="row">
                <div class="col-md-6 mb-3">
                    <label>Full Name</label>
                    {{ form.full_name }}
                </div>

                <div class="col-md-6 mb-3">
                    <label>Date of Birth</label>
                    {{ form.dob }}
                </div>

                <div class="col-md-6 mb-3">
                    <label>ID Type</label>
                    {{ form.id_type }}
                </div>

                <div class="col-md-6 mb-3">
                    <label>ID Number</label>
                    {{ form.id_number }}
                </div>

                <div class="col-md-6 mb-3">
                    <label>ID Document</label>
                    {{ form.id_document }}
                </div>

                <div class="col-md-6 mb-3">
                    <label>Selfie Photo</label>
                    {{ form.selfie }}
                </div>

                <div class="col-md-12 mb-3">
                    <label>Current Address</label>
                    {{ form.address }}
                </div>

                <div class="col-md-12 mb-3">
                    <label>Permanent Address</label>
                    {{ form.permanent_address }}
                </div>

                <div class="col-md-6 mb-3">
                    <label>Emergency Contact</label>
                    {{ form.emergency_contact }}
                </div>

                <div class="col-md-6 mb-3">
                    <label>Occupation</label>
                    {{ form.occupation }}
                </div>
            </div>

            <button type="submit" class="submit-btn" id="submitButton">
                <i class="fa-solid fa-paper-plane"></i>
                {% if kyc.kyc_status in 'submitted verified' %} Update KYC {% else %} Submit KYC {% endif %}
            </button>
        </form>

        {% if kyc.kyc_status == 'submitted' or kyc.kyc_status == 'verified' %}
            </fieldset>
        {% endif %}
    </div>
</div>

<!-- JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
<script>
document.addEventListener("DOMContentLoaded", function () {

    // Hide form if KYC already submitted or approved
    {% if kyc.kyc_status == 'submitted' or kyc.kyc_status == 'verified' %}
        const formCard = document.getElementById("kycFormCard");
        if (formCard) formCard.style.display = "none";
    {% endif %}

    // ONLY show popup if request came AFTER submitting form
    {% if request.method == 'POST' %}
        setTimeout(() => {
            alert("KYC Submitted Successfully! Please wait for the owner's approval.");
            const formCard = document.getElementById("kycFormCard");
            if (formCard) formCard.style.display = "none";
        }, 300);
    {% endif %}

});
</script>

</script>

</body>
</html>
